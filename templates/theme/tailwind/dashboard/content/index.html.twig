{% extends 'dashboard/index.html.twig' %}

{% set _title_extend = store ? store.name : 'Welcome ' ~ app.user.userDetails.firstName %}

{% block content %}
    {% if stores|length and is_granted('ROLE_ADMIN') %}
        <form name="store" method="get" id="store">
            <label for="slug">
                <select name="slug" id="slug">
                    {% if stores|length > 1 %}
                        <option value="{{ url('app_dashboard') }}">{{ 'menu.dashboard'|trans }}</option>
                    {% endif %}
                    {% for store in stores %}
                        <option value="{{ url('app_dashboard', {slug: store.slug}) }}"{{ store.slug == app.request.get('slug') ? ' selected="selected"' : null }}>{{ store.name }}</option>
                    {% endfor %}
                </select>
            </label>
        </form>
    {% endif %}
    <h4 class="my-5 ms-2 text-3xl text-gray-500 dark:text-gray-50 font-oswald">{{ store ? store.name : 'Welcome ' ~ app.user.userDetails.firstName }}</h4>
    {% if store %}
        <div class="grid lg:grid-cols-2 md:grid-cols-2 sm:grid-cols-1 gap-3">
            <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
                <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                    <caption
                            class="p-5 text-lg font-semibold text-left rtl:text-right text-gray-900 bg-white dark:text-white dark:bg-gray-800">
                        {{ 'table.header.customers'|trans }}
                        <p class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-400">{{ 'table.caption.customers'|trans }}</p>
                    </caption>
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="px-6 py-3">
                            {{ 'customer.name'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.joined_at'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.orders'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.country'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            <span class="sr-only">{{ 'table.header.handle'|trans }}</span>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for customer in customers %}
                        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                            <th scope="row"
                                class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white max-w-10 truncate">
                                {{ customer.full_name }}
                            </th>
                            <td class="px-6 py-4">
                                {{ customer.created_at|date(date_format) }}
                            </td>
                            <td class="px-6 py-4">
                                {{ customer.orders }}
                            </td>
                            <td class="px-6 py-4">
                                {{ countries[customer.country] }}
                            </td>
                            <td class="px-6 py-4 text-right">
                                <a href="#" data-modal-target="address-modal" data-modal-toggle="address-modal"
                                   class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
                                    <svg class="w-[20px] h-[20px] text-blue-800 dark:text-white" aria-hidden="true"
                                         xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
                                         viewBox="0 0 24 24">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                              stroke-width="2"
                                              d="M15 9h3m-3 3h3m-3 3h3m-6 1c-.306-.613-.933-1-1.618-1H7.618c-.685 0-1.312.387-1.618 1M4 5h16a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1Zm7 5a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"></path>
                                    </svg>
                                </a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="5"
                                class="px-6 py-4 text-center text-gray-700 bg-gray-100 dark:bg-gray-500 dark:text-white">{{ 'table.footer.not_found'|trans }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
                <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                    <caption
                            class="p-5 text-lg font-semibold text-left rtl:text-right text-gray-900 bg-white dark:text-white dark:bg-gray-800">
                        {{ 'table.header.products'|trans }}
                        <p class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-400">{{ 'table.caption.products'|trans({store: store.name, path: path('app_dashboard_market_place_market_product', {store: store.id})})|raw }}</p>
                    </caption>
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="px-6 py-3">
                            {{ 'label.form.product_name'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.created_at'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.price'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.quantity'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            <span class="sr-only">{{ 'table.header.handle'|trans }}</span>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for product in products %}
                        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                            <th scope="row"
                                class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white max-w-10 truncate">
                                <a class="" data-twe-toggle="tooltip" data-twe-placement="left"
                                   title="{{ product.name }}"
                                   href="{{ path('app_market_place_product', {slug: product.slug, tab: 'about'}) }}"
                                   target="_blank">{{ product.shortName }}</a>
                            </th>
                            <td class="px-6 py-4">
                                {{ product.createdAt|date(date_format) }}
                            </td>
                            <td class="px-6 py-4">
                                <abbr class="cursor-pointer" data-twe-toggle="tooltip"
                                      title="{{ (product.cost) }} + {{ (product.fee) }}">
                                    {{ (product.cost + product.fee)|amount_format }}<small
                                            class="ps-0.5">{{ store.currency|currency }}</small>
                                </abbr>
                            </td>
                            <td class="px-6 py-4">
                                {{ product.quantity }}
                            </td>
                            <td class="px-6 py-4 text-right">
                                <a href="{{ path('app_dashboard_market_place_edit_product', {store: store.id, id: product.id, tab: 'details'}) }}"
                                   class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
                                    <svg class="w-[20px] h-[20px] text-green-700 dark:text-white" aria-hidden="true"
                                         xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
                                         viewBox="0 0 24 24">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                              stroke-width="2"
                                              d="m14.304 4.844 2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565 6.844-6.844a2.015 2.015 0 0 1 2.852 0Z"></path>
                                    </svg>
                                </a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="5"
                                class="px-6 py-4 text-center text-gray-700 bg-gray-100 dark:bg-gray-500 dark:text-white">{{ 'table.footer.not_found'|trans }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <hr class="h-px my-8 bg-gray-200 border-0 dark:bg-gray-700">
        <div class="grid lg:grid-cols-2 md:grid-cols-2 sm:grid-cols-1 gap-3">
            <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
                <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                    <caption
                            class="p-5 text-lg font-semibold text-left rtl:text-right text-gray-900 bg-white dark:text-white dark:bg-gray-800">
                        {{ 'table.header.messages'|trans }}
                        <p class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-400">{{ 'table.caption.messages'|trans({path: '#'})|raw }}</p>
                    </caption>
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.customer'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.created_at'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.priority'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            <span class="sr-only">{{ 'table.header.review'|trans }}</span>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for message in messages %}
                        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                            <th scope="row" data-twe-toggle="tooltip" data-twe-html="true" data-twe-placement="top"
                                title="{{ message.customer.phone }}"
                                class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white max-w-10 truncate cursor-pointer">
                                {{ message.customer.firstName }} {{ message.customer.lastName }}
                            </th>
                            <td class="px-6 py-4">
                                {{ message.createdAt|date(date_format) }}
                            </td>
                            <td class="px-6 py-4 capitalize">
                                {{ message.priority }}
                            </td>
                            <td class="px-6 py-4 text-right">
                                <a href="#"
                                   class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
                                    <svg class="w-[20px] h-[20px] text-blue-700 dark:text-white" aria-hidden="true"
                                         xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
                                         viewBox="0 0 24 24">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                              stroke-width="2" d="M9 17h6l3 3v-3h2V9h-2M4 4h11v8H9l-3 3v-3H4V4Z"></path>
                                    </svg>
                                </a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="4"
                                class="px-6 py-4 text-center text-gray-700 bg-gray-100 dark:bg-gray-500 dark:text-white">{{ 'table.footer.not_found'|trans }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
                <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                    <caption
                            class="p-5 text-lg font-semibold text-left rtl:text-right text-gray-900 bg-white dark:text-white dark:bg-gray-800">
                        {{ 'table.header.orders'|trans }}
                        <p class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-400">{{ 'table.caption.orders'|trans({path: path('app_dashboard_market_place_order_store_current', {store: store.id})})|raw }}</p>
                    </caption>
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.order_number'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.created_at'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.status'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            {{ 'table.header.amount'|trans }}
                        </th>
                        <th scope="col" class="px-6 py-3">
                            <span class="sr-only">{{ 'table.header.handle'|trans }}</span>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for order in orders %}
                        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                            <th scope="row"
                                class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white max-w-10 truncate">
                                {{ order.number }}
                            </th>
                            <td class="px-6 py-4">
                                {{ order.createdAt|date(date_format) }}
                            </td>
                            <td class="px-6 py-4 capitalize">
                                {{ order.status }}
                            </td>
                            <td class="px-6 py-4">
                                {{ order.total|amount_format }}<small
                                        class="ps-0.5">{{ store.currency|currency }}</small>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <a href="{{ path('app_dashboard_market_place_order_details_market', {store: store.id, number: order.number}) }}"
                                   class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
                                    <svg class="w-[20px] h-[20px] text-blue-700 dark:text-white" aria-hidden="true"
                                         xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
                                         viewBox="0 0 24 24">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                              stroke-width="2"
                                              d="M12 6h8m-8 6h8m-8 6h8M4 16a2 2 0 1 1 3.321 1.5L4 20h5M4 5l2-1v6m-2 0h4"></path>
                                    </svg>
                                </a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="5"
                                class="px-6 py-4 text-center text-gray-700 bg-gray-100 dark:bg-gray-500 dark:text-white">{{ 'table.footer.not_found'|trans }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div id="address-modal" tabindex="-1" aria-hidden="true"
             class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
            <div class="relative p-4 w-full max-w-2xl max-h-full">
                <!-- Modal content -->
                <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                    <!-- Modal header -->
                    <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                            {{ 'customer.address'|trans }}
                        </h3>
                        <button type="button"
                                class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
                                data-modal-hide="address-modal">
                            <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                                 viewBox="0 0 14 14">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                      stroke-width="2"
                                      d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path>
                            </svg>
                            <span class="sr-only">Close modal</span>
                        </button>
                    </div>
                    <div class="p-4 md:p-5 space-y-4">
                        <p class="text-base leading-relaxed text-gray-500 dark:text-gray-400">
                            With less than a month to go before the European Union enacts new consumer privacy laws for
                            its
                            citizens, companies around the world are updating their terms of service agreements to
                            comply.
                        </p>
                        <p class="text-base leading-relaxed text-gray-500 dark:text-gray-400">
                            The European Unionâ€™s General Data Protection Regulation (G.D.P.R.) goes into effect on May
                            25
                            and is meant to ensure a common set of data rights in the European Union. It requires
                            organizations to notify users as soon as possible of high-risk data breaches that could
                            personally affect them.
                        </p>
                    </div>
                    <div class="text-right p-4 md:p-5 border-t border-gray-200 rounded-b dark:border-gray-600">
                        <button data-modal-hide="address-modal" type="button"
                                class="py-2.5 px-5 ms-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">{{ 'form.action.close'|trans }}</button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        let selector = document.getElementById('store');
        if (selector !== null) {
            selector = selector.querySelector('select');
            selector.addEventListener('change', () => window.location.replace(selector.value));
        }
    </script>
{% endblock %}